<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Strict//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-strict.dtd">
<!--
    Copyright 2013 James McClure

   Licensed under the Apache License, Version 2.0 (the "License");
   you may not use this file except in compliance with the License.
   You may obtain a copy of the License at

       http://www.apache.org/licenses/LICENSE-2.0

   Unless required by applicable law or agreed to in writing, software
   distributed under the License is distributed on an "AS IS" BASIS,
   WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
   See the License for the specific language governing permissions and
   limitations under the License.
-->
<!--
Design by Free CSS Templates
http://www.freecsstemplates.org
Released for free under a Creative Commons Attribution 3.0 License

Name       : Singular
Description: A two-column, fixed-width design with a neutral color scheme.
Version    : 1.0
Released   : 20121119
-->
<html xmlns="http://www.w3.org/1999/xhtml">
	<head>
		<meta http-equiv="content-type" content="text/html; charset=utf-8" />
		<meta name="description" content="A Java MQTT client, Mock MQTT Broker, HTTP to MQTT gateway, and MQTT clustering proxy" />
		<meta name="keywords" content="" />
		<title>Xenqtt - A Simple and Innovative Tookit for MQTT Integration</title>
		<link rel="shortcut icon" href="images/favicon.ico">
		<link href="resources/prettify.css" type="text/css" rel="stylesheet" />
		<script type="text/javascript" src="resources/prettify.js"></script>
		<link rel="stylesheet" type="text/css" href="style.css" />
		<script>
		  (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
		  (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
		  m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
		  })(window,document,'script','//www.google-analytics.com/analytics.js','ga');
		
		  ga('create', 'UA-44597320-1', 'sourceforge.net');
		  ga('send', 'pageview');
		
		</script>
	</head>
	<body onload="prettyPrint()">
		<div id="wrapper">
			<div id="header">
				<img src="images/happy-minion.png" />
				<div id="logo">
					<h1><a href="index.html">XenQTT</a></h1>
				</div>
				<div id="menu">
					<ul>
						<li class="first"><a href="index.html">Home</a></li>
						<li><a href="features.html">Features</a></li>
						<li><a href="usage.html">Usage</a></li>
						<li><a href="http://sourceforge.net/projects/xenqtt/files">Downloads</a></li>
						<li><a href="http://sourceforge.net/p/xenqtt/tickets">Tickets</a></li>
						<li class="last"><a href="about.html">About</a></li>
					</ul>
					<br class="clearfix" />
				</div>
			</div>
			<div id="page">
				<div id="content">
					<div class="post">
						<h2>Usage</h2>
						<ul class="list">
						<li class="first"><a href="apidocs/">API Docs (JavaDoc)</a></li>
						<li><a href="#maven">Maven Integration</a></li>
						<li><a href="#cmdline">The XenQTT Command Line</a></li>
						<li><a href="#proxy">Running the Clustering Proxy</a></li>
						<li><a href="#mockbroker">Running the Mock Broker</a></li>
						<li><a href="#clientapi">Using the Client API</a></li>
						<li><a href="#mockbrokerapi">Using the Mock Broker API</a></li>
						<li class="last"><a href="#links">Related Resources</a></li>
						</ul>
					</div>
					<div class="post">
						<h3 id="maven">Maven Integration</h3>
						<p>
						XenQTT is released to the central maven repository. Add this dependency element with the latest version number to your <code>pom.xml</code>:
						<pre class="prettyprint code">
&lt;dependency&gt;
    &lt;groupId&gt;net.sf.xenqtt&lt;/groupId&gt;
    &lt;artifactId&gt;xenqtt&lt;/artifactId&gt;
    &lt;version&gt;...&lt;/version&gt;
&lt;/dependency&gt;	</pre>
						</p>
					</div>
					<div class="post" id="cmdline">
						<h3>The XenQTT Command Line</h3>
						<p>
						XenQTT is released as a single jar. To run any XenQTT application you execute the jar:
						<pre class="prettyprint code">
java -jar xenqtt-version global options APP app options
						</pre>
						<ul class="list">
						<li class="first">version: The XenQTT version number.</li>
						<li class="last">Global Options: </li>
						</ul>
						</p>
					</div>
					<div class="post" id="proxy">
						<h3>Running the Clustering Proxy</h3>
					</div>
					<div class="post" id="mockbroker">
						<h3>Running the Mock Broker</h3>
					</div>
					<div class="post" id="clientapi">
						<h3>Using the Client API</h3>
						<p>
						In this section you will find examples and code samples showing how to use XenQTT. This section is divided into examples for the client,
						the proxy, the gateway, and the mock broker.
						</p>
						<h4>Client</h4>
						<strong>Overview</strong>
						<p>
						XenQTT provides two distinct MQTT clients for interfacing with MQTT brokers. One is a synchronous client where all operations to the
						broker (connect, publish, subscribe, etc.) are blocking. The other is an asynchronous client where operations to the broker are
						non-blocking. Interaction with broker events in the asynchronous client are handled via callbacks in a specific interface that the
						user must implement.
						</p>
						<p>
						The following sections show how to use both the synchronous and asynchronous clients. You are taken through a subscriber and publisher
						model where the subscriber attempts to build up a musical catalog of classic rock with a paired publisher that is only too happy to
						provide.
						</p>
						<strong>Synchronous Client Example</strong>
						<p class="code-header">Synchronous Subscriber</p>
						<pre class="prettyprint code">
import java.util.ArrayList;
import java.util.List;

import net.sf.XenQTT.client.MqttClient;
import net.sf.XenQTT.client.MqttClientListener;
import net.sf.XenQTT.client.PublishMessage;
import net.sf.XenQTT.client.Subscription;
import net.sf.XenQTT.client.SynchronousMqttClient;
import net.sf.XenQTT.message.ConnectReturnCode;
import net.sf.XenQTT.message.QoS;

import org.apache.log4j.Logger;

/**
 * Builds music catalogs from years gone by.
 */
public class MusicSubscriber {

	private static final Logger log = Logger.getLogger(MusicSubscriber.class);

	public static void main(String... args) throws Throwable {
		final List<String> catalog = new ArrayList<String>();
		MqttClientListener listener = new MqttClientListener() {

			@Override
			public void publishReceived(MqttClient client, PublishMessage message) {
				catalog.add(message.getPayloadString());
				message.ack();
			}

			@Override
			public void disconnected(MqttClient client, Throwable cause, boolean reconnecting) {
				if (cause != null) {
					log.error("Disconnected from the broker due to an exception.", cause);
				} else {
					log.info("Disconnecting from the broker.");
				}

				if (reconnecting) {
					log.info("Attempting to reconnect to the broker.");
				}
			}

		};

		// Build your client. This client is a synchronous one so all interaction with the broker will block until said interaction completes.
		SyncMqttClient client = new SyncMqttClient("tcp://mqtt.broker:1883", listener, 5);

		// Connect to the broker with a specific client ID. Only if the broker accepted the connection shall we proceed.
		ConnectReturnCode returnCode = client.connect("musicLover", true);
		if (returnCode != ConnectReturnCode.ACCEPTED) {
			log.error("Unable to connect to the MQTT broker. Reason: " + returnCode);
			return;
		}

		// Create your subscriptions. In this case we want to build up a catalog of classic rock.
		List<Subscription> subscriptions = new ArrayList<Subscription>();
		subscriptions.add(new Subscription("grand/funk/railroad", QoS.AT_MOST_ONCE));
		subscriptions.add(new Subscription("jefferson/airplane", QoS.AT_MOST_ONCE));
		subscriptions.add(new Subscription("seventies/prog/#", QoS.AT_MOST_ONCE));
		client.subscribe(subscriptions);

		// Build up your catalog. After a while you've waited long enough so move on.
		try {
			Thread.sleep(30000);
		} catch (InterruptedException ignore) {
		}

		// Report on what we have found.
		for (String record : catalog) {
			log.debug("Got a record: " + record);
		}

		// We are done. Unsubscribe and disconnect.
		List<String> topics = new ArrayList<String>();
		for (Subscription subscription : subscriptions) {
			topics.add(subscription.getTopic());
		}
		client.unsubscribe(topics);
		client.disconnect();
	}

}
						</pre>
						<p class="code-header">Synchronous Publisher</p>
						<pre class="prettyprint code">
import net.sf.XenQTT.client.MqttClient;
import net.sf.XenQTT.client.MqttClientListener;
import net.sf.XenQTT.client.PublishMessage;
import net.sf.XenQTT.client.SynchronousMqttClient;
import net.sf.XenQTT.message.QoS;

import org.apache.log4j.Logger;

/**
 * Produces hit music from days gone by.
 */
public class MusicProducer {

	private static final Logger log = Logger.getLogger(MusicProducer.class);

	public static void main(String... args) throws Throwable {
		MqttClientListener listener = new MqttClientListener() {

			@Override
			public void publishReceived(MqttClient client, PublishMessage message) {
				log.warn("Received a message when no subscriptions were active. Check your broker ;)");
			}

			@Override
			public void disconnected(MqttClient client, Throwable cause, boolean reconnecting) {
				if (cause != null) {
					log.error("Disconnected from the broker due to an exception.", cause);
				} else {
					log.info("Disconnected from the broker.");
				}

				if (reconnecting) {
					log.info("Attempting to reconnect to the broker.");
				}
			}
		};

		// Build your client. This client is a synchronous one so all interaction with the broker will block until said interaction completes.
		MqttClient client = new SyncMqttClient("tcp://mqtt.broker:1883", listener, 5);

		// Publish a musical catalog
		client.publish(new PublishMessage("grand/funk/railroad", QoS.AT_MOST_ONCE, "On Time"));
		client.publish(new PublishMessage("grand/funk/railroad", QoS.AT_MOST_ONCE, "E Pluribus Funk"));
		client.publish(new PublishMessage("jefferson/airplane", QoS.AT_MOST_ONCE, "Surrealistic Pillow"));
		client.publish(new PublishMessage("jefferson/airplane", QoS.AT_MOST_ONCE, "Crown of Creation"));
		client.publish(new PublishMessage("seventies/prog/rush", QoS.AT_MOST_ONCE, "2112"));
		client.publish(new PublishMessage("seventies/prog/rush", QoS.AT_MOST_ONCE, "A Farewell to Kings"));
		client.publish(new PublishMessage("seventies/prog/rush", QoS.AT_MOST_ONCE, "Hemispheres"));

		// We are done. Disconnect.
		client.disconnect();
	}

}
						</pre>
						<strong>Asynchronous Client Example</strong>
						<p class="code-header">Asynchronous Subscriber</p>
						<pre class="prettyprint code">
import java.util.ArrayList;
import java.util.Arrays;
import java.util.List;

import net.sf.XenQTT.client.AsyncClientListener;
import net.sf.XenQTT.client.AsyncMqttClient;
import net.sf.XenQTT.client.MqttClient;
import net.sf.XenQTT.client.PublishMessage;
import net.sf.XenQTT.client.Subscription;
import net.sf.XenQTT.message.ConnectReturnCode;
import net.sf.XenQTT.message.QoS;

import org.apache.log4j.Logger;

/**
 * Builds music catalogs from years gone by.
 */
public class MusicSubscriberAsync {

	private static final Logger log = Logger.getLogger(MusicSubscriberAsync.class);

	public static void main(String... args) throws Throwable {
		final List<String> catalog = new ArrayList<String>();
		AsyncClientListener listener = new AsyncClientListener() {

			@Override
			public void publishReceived(MqttClient client, PublishMessage message) {
				catalog.add(message.getPayloadString());
				message.ack();
			}

			@Override
			public void disconnected(MqttClient client, Throwable cause, boolean reconnecting) {
				if (cause != null) {
					log.error("Disconnected from the broker due to an exception.", cause);
				} else {
					log.info("Disconnecting from the broker.");
				}

				if (reconnecting) {
					log.info("Attempting to reconnect to the broker.");
				}
			}

			@Override
			public void connected(MqttClient client, ConnectReturnCode returnCode) {
				if (returnCode != ConnectReturnCode.ACCEPTED) {
					log.error("Unable to connect to the broker. Reason: " + returnCode);
					// TODO - Handle this per your application's requirements
				}
			}

			@Override
			public void published(MqttClient client, PublishMessage message) {
				// We do not publish so this should never be called, in theory ;).
			}

			@Override
			public void subscribed(MqttClient client, Subscription[] requestedSubscriptions, Subscription[] grantedSubscriptions, boolean requestsGranted) {
				if (!requestsGranted) {
					log.error("Unable to subscribe to the following subscriptions: " + Arrays.toString(requestedSubscriptions));
					// TODO - Handle this per-application requirements
				}

				log.debug("Granted subscriptions: " + Arrays.toString(grantedSubscriptions));
			}

			@Override
			public void unsubscribed(MqttClient client, String[] topics) {
				log.debug("Unsubscribed from the following topics: " + Arrays.toString(topics));
				// TODO - Implement application-specific logic here, if any
			}

		};

		// Build your client. This client is a synchronous one so all interaction with the broker will block until said interaction completes.
		AsyncMqttClient client = new AsyncMqttClient("tcp://mqtt.broker:1883", listener, 5);

		// Connect to the broker with a specific client ID. Only if the broker accepted the connection shall we proceed.
		ConnectReturnCode returnCode = client.connect("musicLover", true);
		if (returnCode != ConnectReturnCode.ACCEPTED) {
			log.error("Unable to connect to the MQTT broker. Reason: " + returnCode);
			return;
		}

		// Create your subscriptions. In this case we want to build up a catalog of classic rock.
		List<Subscription> subscriptions = new ArrayList<Subscription>();
		subscriptions.add(new Subscription("grand/funk/railroad", QoS.AT_MOST_ONCE));
		subscriptions.add(new Subscription("jefferson/airplane", QoS.AT_MOST_ONCE));
		subscriptions.add(new Subscription("seventies/prog/#", QoS.AT_MOST_ONCE));
		client.subscribe(subscriptions);

		// Build up your catalog. After a while you've waited long enough so move on.
		try {
			Thread.sleep(30000);
		} catch (InterruptedException ignore) {
		}

		// Report on what we have found.
		for (String record : catalog) {
			log.debug("Got a record: " + record);
		}

		// We are done. Unsubscribe and disconnect.
		List<String> topics = new ArrayList<String>();
		for (Subscription subscription : subscriptions) {
			topics.add(subscription.getTopic());
		}
		client.unsubscribe(topics);
		client.disconnect();
	}

}
						</pre>
						<p class="code-header">Asynchronous Publisher</p>
						<pre class="prettyprint code">
import net.sf.XenQTT.client.AsyncClientListener;
import net.sf.XenQTT.client.AsyncMqttClient;
import net.sf.XenQTT.client.MqttClient;
import net.sf.XenQTT.client.PublishMessage;
import net.sf.XenQTT.client.Subscription;
import net.sf.XenQTT.message.ConnectReturnCode;
import net.sf.XenQTT.message.QoS;

import org.apache.log4j.Logger;

/**
 * Produces hit music from days gone by.
 */
public class MusicProducerAsync {

	private static final Logger log = Logger.getLogger(MusicProducerAsync.class);

	public static void main(String... args) throws Throwable {
		AsyncClientListener listener = new AsyncClientListener() {

			@Override
			public void publishReceived(MqttClient client, PublishMessage message) {
				log.warn("Received a message when no subscriptions were active. Check your broker ;)");
			}

			@Override
			public void disconnected(MqttClient client, Throwable cause, boolean reconnecting) {
				if (cause != null) {
					log.error("Disconnected from the broker due to an exception.", cause);
				} else {
					log.info("Disconnected from the broker.");
				}

				if (reconnecting) {
					log.info("Attempting to reconnect to the broker.");
				}
			}

			@Override
			public void connected(MqttClient client, ConnectReturnCode returnCode) {
				if (returnCode != ConnectReturnCode.ACCEPTED) {
					log.error("The broker rejected our attempt to connect. Reason: " + returnCode);
				}
			}

			@Override
			public void subscribed(MqttClient client, Subscription[] requestedSubscriptions, Subscription[] grantedSubscriptions, boolean requestsGranted) {
			}

			@Override
			public void unsubscribed(MqttClient client, String[] topics) {
			}

			@Override
			public void published(MqttClient client, PublishMessage message) {
			}

		};

		// Build your client. This client is a synchronous one so all interaction with the broker will block until said interaction completes.
		MqttClient client = new AsyncMqttClient("tcp://mqtt.broker:1883", listener, 5);

		// Publish a musical catalog
		client.publish(new PublishMessage("grand/funk/railroad", QoS.AT_MOST_ONCE, "On Time"));
		client.publish(new PublishMessage("grand/funk/railroad", QoS.AT_MOST_ONCE, "E Pluribus Funk"));
		client.publish(new PublishMessage("jefferson/airplane", QoS.AT_MOST_ONCE, "Surrealistic Pillow"));
		client.publish(new PublishMessage("jefferson/airplane", QoS.AT_MOST_ONCE, "Crown of Creation"));
		client.publish(new PublishMessage("seventies/prog/rush", QoS.AT_MOST_ONCE, "2112"));
		client.publish(new PublishMessage("seventies/prog/rush", QoS.AT_MOST_ONCE, "A Farewell to Kings"));
		client.publish(new PublishMessage("seventies/prog/rush", QoS.AT_MOST_ONCE, "Hemispheres"));

		// We are done. Disconnect.
		client.disconnect();
	}

}
						</pre>
						<h4>Proxy</h4>
						<h4>Gateway</h4>
						<h4>Mock Broker</h4>
					</div>
					<div class="post" id="mockbrokerapi">
						<h3>Using the Mock Broker API</h3>
					</div>
					<div class="post post-last" id="links">
						<h3>Related Resources</h3>
						<a href="http://mqtt.org">MQTT Overview</a><img src="images/ext-link.gif" height="10" width="10" />
					</div>
				</div>
			</div>
		</div>
		<div id="footer">
			&copy; 2013 J2 Enterprises | Design by <a href="http://www.freecsstemplates.org/" rel="nofollow">FreeCSSTemplates.org</a> | Images by <a href="http://fotogrph.com/">Fotogrph</a>
		</div>
	</body>
</html>